sudo: false
cache: bundler
language: ruby
services:
- memcache
- redis-server
script:
- bundle exec rake spec
- bundle exec rake karma:run
- bundle exec rubocop -R
before_script:
- PHANTOMJS_CDNURL=https://bitbucket.org/ariya/phantomjs/downloads npm install
- psql -c 'create database mpdx_test;' -U postgres
- cp config/database.travis.yml config/database.yml
- cp config/config.travis.yml config/config.yml
- cp config/cloudinary.travis.yml config/cloudinary.yml
- bundle exec rake db:schema:load RAILS_ENV=test
branches:
  only:
  - master
deploy:
  provider: opsworks
  access_key_id: AKIAJYX4CH7WF7CZ2QIA
  secret_access_key:
    secure: ey938k7XvkH7o0ffEKIedVR/Pf3sYjaTUu241zK6HLuB3Lj8hVM+nV863eIqreCOMqRCRYCb+Hqe9t4wFhsIANJXsAr7ecx/BHNc68hqWeti6BAGZTBNsJssOX2Kncq/FR+o2WOuwNHFRH2ZT7JSU1pU4qpRXL5ZLTJpUl8TAuo=
  app-id: 36c106d9-e3c9-495c-a826-1e29854d12c7
  migrate: true
  on:
    repo: CruGlobal/mpdx
