var confirm_close_message = '<%= _('It looks like you were adding some referrals. If you leave '+
                                   'before submitting, your changes will be lost.') %>';

$('#referrals_modal').html('<%= j(render('add_multi')) %>');

$('#referrals_modal').dialog({
  width: 900, maxHeight: 640, modal: true,
  buttons: [
    {
      text: __('Save'),
      click: function() {
        window.onbeforeunload = undefined;
        $('form', this).submit();
        $('.form_wrapper', this).html('<%= image_tag('spinner.gif') %>');
        $(this).dialog( "option", "buttons", []);
      },
    },
    {
      text: __('Cancel'),
      click: function() {
        $(this).dialog('close');
      }
    }
  ],
  beforeClose: function() {
    if(!$('#referrals_modal form').hasClass('dirty'))
      return true;
    return confirm(confirm_close_message + ' <%= _('Are you sure you want to close?') %>');
  },
  close: function() {
    $('#referrals_modal form').removeClass('dirty');
  }
});

$('#referrals_modal').dialog('option', 'position', { my: "center", at: "center", of: window });
$('#referrals_modal').dialog('option', 'title', '<%= @modal_title %>');
$('#referrals_modal form').areYouSure({
  message: confirm_close_message
});
