<div ng-show="!vm.preferences.loading">
  <div id="contentbody" class="withleft">
    <div class="wpp">
      <div class="row">
        <div class="col-md-12">
          <div class="page-filters">
            <h2><%= _('Connect Services') %></h2>
          </div>
        </div>
      </div>
      <p>&nbsp;</p>
      <div class="row">
        <div class="col-md-12">
          <h3><%= _('Internal Services') %></h3>
        </div>
      </div>
      <div class="panel-group">
        <div class="panel panel-default pref-panel">
          <div class="panel-heading pref-head" ng-click="vm.setTab('key')">
            <i class="fa fa-angle-right" ng-class="{ 'fa-rotate-90' : vm.tabSelected('key') }"></i>
            <%= _('Key / Relay') %>
            <div class="pull-right">
              <div class="accstatus accstatus-enabled" ng-show="vm.preferences.data.valid_key_account"><i class="fa fa-circle"></i></div>
              <div class="accstatus accstatus-disabled" ng-hide="vm.preferences.data.valid_key_account"><i class="fa fa-circle-o"></i></div>
            </div>
          </div>
          <div class="panel-animate" ng-show="vm.tabSelected('key')">
            <div class="panel-body pref-body">
              <div class="row pref-row">
                <div class="col-md-4 pref-lead">
                  <div class="import_logo">
                    <img alt="key" src="/dev-assets/logos/key_logo.png">
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="network_button network_connect">
                    <div ng-repeat="account in vm.preferences.data.key_accounts" class="network_connections">
                      <div class="account_single">
                        <div class="actions">
                          <a class="inlineaction delete" ng-click="vm.disconnect('Key', account.id)"><%= _('Delete') %></a>
                        </div>
                        <span class="account_name">{{account.email}}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel panel-default pref-panel">
          <div class="panel-heading pref-head" ng-click="vm.setTab('organization')">
            <i class="fa fa-angle-right" ng-class="{ 'fa-rotate-90' : vm.tabSelected('organization') }"></i>
            <%= _('Organization') %>
            <div class="pull-right">
              <!-- Title Meta / Indicator -->
            </div>
          </div>
          <div class="panel-animate" ng-show="vm.tabSelected('organization')">
            <div class="panel-body pref-body">
              <div class="row pref-row">
                <div class="col-md-4 pref-lead">
                  <div class="import_logo">
                    <%= image_tag("logos/organization_logo.png", alt: 'organization') %>
                  </div>
                </div>
                <div class="col-md-8 connections">
                  <organization-integration-preferences></organization-integration-preferences>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <h3><%= _('External Services') %></h3>
        </div>
      </div>
      <div class="panel-group">
        <div class="panel panel-default pref-panel">
          <div class="panel-heading pref-head" ng-click="vm.setTab('google')">
            <i class="fa fa-angle-right" ng-class="{ 'fa-rotate-90' : vm.tabSelected('google') }"></i>
            <%= _('Google') %>
            <div class="pull-right">
              <div class="accstatus accstatus-enabled" ng-show="vm.preferences.data.valid_google_account"><i class="fa fa-circle"></i></div>
              <div class="accstatus accstatus-disabled" ng-hide="vm.preferences.data.valid_google_account"><i class="fa fa-circle-o"></i></div>
            </div>
          </div>
          <div class="panel-animate" ng-show="vm.tabSelected('google')">
            <div class="panel-body pref-body">
              <div class="row pref-row">
                <div class="col-md-4 pref-lead">
                  <div class="network_logo">
                    <%= image_tag("logos/google_logo.png", alt: 'Google') %>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="network_button network_connect">
                    <div ng-repeat="account in vm.preferences.data.google_accounts" class="network_connections">
                      <div class="account_single">
                        <div class="actions">
                          <a class="inlineaction delete" ng-click="vm.disconnect('Google', account.id)"><%= _('Delete') %></a>
                        </div>
                        <span class="account_name">{{account.email}}</span>

                        <div ng-show="account.token_expired == true">
                          <p>
                            <%= _('The link between MPDX and your Google account stopped working. '+
                                  'Click "Refresh Google Account" to re-enable it. After that, '+
                                  'you\'ll need to manually re-enable any integrations that you had set already.') %>
                          </p>
                          <%# new_account_path_opts = { provider: :google } %>
                          <%# new_account_path_opts[:redirect] =  google_integration_path(google_integration) if google_integration %>
                          <%#= link_to(_('Refresh Google Account'), new_account_path(new_account_path_opts), class: 'btn desired_action') %>
                        </div>
                        <div ng-show="account.token_expired == false">
                          <div ng-show="account.google_integration_id != null">
                            <a ng-href="/google_integrations/{{account.google_integration_id}}">
                              <i class="fa fa-refresh"></i>
                              <%= _('Configure synchronization') %>
                            </a>
                          </div>
                          <div ng-show="account.google_integration_id == null">
                            <a data-method="post" ng-href="/google_integrations?google_account_id={{account.id}}" rel="nofollow">
                              <i class="fa fa-refresh"></i>
                              <%= _('Configure synchronization') %>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div ng-hide="vm.preferences.data.valid_google_account">
                      <%= _('You can keep Google in sync with your contacts, calendars, tasks and more. Click Add Account to begin.') %>
                    </div>
                    <br />
                    <%= link_to(_('Add Account'), '/auth/google', :class => 'btn btn-primary', target: '_blank') %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel panel-default pref-panel">
          <div class="panel-heading pref-head" ng-click="vm.setTab('mailchimp')">
            <i class="fa fa-angle-right" ng-class="{ 'fa-rotate-90' : vm.tabSelected('mailchimp') }"></i>
            <%= _('Mailchimp') %>
            <div class="pull-right">
              <div class="accstatus accstatus-enabled" ng-show="vm.mailchimpAccStatus == 'enabled'"><i class="fa fa-circle"></i></div>
              <div class="accstatus accstatus-error" ng-show="vm.mailchimpAccStatus == 'error'"><i class="fa fa-circle-o"></i></div>
              <div class="accstatus accstatus-disabled" ng-show="vm.mailchimpAccStatus == 'disabled'"><i class="fa fa-circle-o"></i></div>
            </div>
          </div>
          <div class="panel-animate" ng-show="vm.tabSelected('mailchimp')">
            <div class="panel-body pref-body">
              <div class="row pref-row">
                <div class="col-md-4 pref-lead">
                  <div class="network_logo">
                    <%= image_tag("logos/mailchimp_logo.png", alt: 'MailChimp') %>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="network_button">
                    <mailchimp-integration-preferences state="vm.mailchimpAccStatus"></mailchimp-integration-preferences>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel panel-default pref-panel">
          <div class="panel-heading pref-head" ng-click="vm.setTab('prayerletters')">
            <i class="fa fa-angle-right" ng-class="{ 'fa-rotate-90' : vm.tabSelected('prayerletters') }"></i>
            <%= _('PrayerLetters.com') %>
            <div class="pull-right">
              <div ng-show="vm.preferences.data.prayer_letters_account">
                <div class="accstatus accstatus-enabled" ng-show="vm.preferences.data.valid_prayer_letters_account"><i class="fa fa-circle"></i></div>
                <div class="accstatus accstatus-error" ng-hide="vm.preferences.data.valid_prayer_letters_account"><i class="fa fa-circle-o"></i></div>
              </div>
              <div ng-hide="vm.preferences.data.prayer_letters_account">
                <div class="accstatus accstatus-disabled"><i class="fa fa-circle-o"></i></div>
              </div>
            </div>
          </div>
          <div class="panel-animate" ng-show="vm.tabSelected('prayerletters')">
            <div class="panel-body pref-body">
              <div class="row pref-row">
                <div class="col-md-4 pref-lead">
                  <div class="network_logo">
                    <%= image_tag("logos/prayer_letters_logo.png", alt: 'Prayer Letters') %>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="network_button">
                    <div class="alert alert-warning">
                      <%= _('Enabling or Syncing will replace your prayerletters.com lists') %>
                    </div>
                    <div ng-show="vm.preferences.data.valid_prayer_letters_account">
                      <button type="submit" ng-click="vm.sync('Prayer Letters')" ng-disabled="vm.saving" class="btn btn-primary btn-actionable"><%= _('Sync Now') %>&nbsp;<div class="btn-progress" ng-show="vm.saving"><i class="fa fa-circle-o-notch fa-spin fa-fw"></i></div></button>
                      <a class="btn btn-link" ng-click="vm.disconnect('Prayer Letters')"><%= _('Disconnect') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></a>
                    </div>
                    <div ng-hide="vm.preferences.data.valid_prayer_letters_account">
                      <p><%= _('You can keep PrayerLetters.com updated with all your MPDX contacts. Click Enable to begin.') %></p>
                      <%= link_to(_('Enable'), '/auth/prayer_letters', :class => 'btn btn-primary', target: '_blank') %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% if $rollout.active?(:pls_integration, current_account_list) %>
        <div class="panel panel-default pref-panel">
          <div class="panel-heading pref-head" ng-click="vm.setTab('myletterservice')">
            <i class="fa fa-angle-right" ng-class="{ 'fa-rotate-90' : vm.tabSelected('myletterservice') }"></i>
            <%= _('MyLetterService.org') %>
            <div class="pull-right">
              <div ng-show="vm.preferences.data.pls_account">
                <div class="accstatus accstatus-enabled" ng-show="vm.preferences.data.valid_pls_account"><i class="fa fa-circle"></i></div>
                <div class="accstatus accstatus-error" ng-hide="vm.preferences.data.valid_pls_account"><i class="fa fa-circle-o"></i></div>
              </div>
              <div ng-hide="vm.preferences.data.pls_account">
                <div class="accstatus accstatus-disabled"><i class="fa fa-circle-o"></i></div>
              </div>
            </div>
          </div>
          <div class="panel-animate" ng-show="vm.tabSelected('myletterservice')">
            <div class="panel-body pref-body">
              <div class="row pref-row">
                <div class="col-md-4 pref-lead">
                  <div class="network_logo">
                    <%= image_tag("logos/pls_logo.png", alt: 'Prayer Letters') %>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="network_button">
                    <div class="alert alert-warning">
                      <%= _('Enabling or Syncing will replace your myletterservice.org lists') %>
                    </div>
                    <div ng-show="vm.preferences.data.valid_pls_account">
                      <button type="submit" ng-click="vm.sync('PLS')" ng-disabled="vm.saving" class="btn btn-primary btn-actionable"><%= _('Sync Now') %>&nbsp;<div class="btn-progress" ng-show="vm.saving"><i class="fa fa-circle-o-notch fa-spin fa-fw"></i></div></button>
                      <a class="btn btn-link" ng-click="vm.disconnect('PLS')"><%= _('Disconnect') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></a>
                    </div>
                    <div ng-hide="vm.preferences.data.valid_pls_account">
                      <p><%= _('You can keep myletterservice.org updated with all your MPDX contacts. Click Enable to begin.') %></p>
                      <%= link_to _('Enable'), '/auth/pls', :class => 'btn btn-primary', target: '_blank' %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% end %>
        <div class="panel panel-default pref-panel">
          <div class="panel-heading pref-head" ng-click="vm.setTab('chalkline')">
            <i class="fa fa-angle-right" ng-class="{ 'fa-rotate-90' : vm.tabSelected('chalkline') }"></i>
            <%= _('Chalkline') %>
            <div class="pull-right">
              <div class="accstatus accstatus-disabled"><i class="fa fa-circle-o"></i></div>
            </div>
          </div>
          <div class="panel-animate" ng-show="vm.tabSelected('chalkline')">
            <div class="panel-body pref-body">
              <div class="row pref-row">
                <div class="col-md-4 pref-lead">
                  <div class="network_logo">
                    <%= image_tag("logos/chalkline_logo.png", alt: 'Chalk Line') %>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="network_button">
                    <div class="alert alert-warning">
                      <%= _('Clicking "Send Paper Newsletter List" will email Chalkline your newsletter list and open their order form in a new tab') %>
                    </div>
                    <p><%= _('Chalkline is a great way of sending a variety of touch cards to your supporters.') %></p>
                    <%= link_to _('Send Paper Newsletter List'), '#', id: 'chalkline_send_list', class: 'btn btn-secondary' %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
