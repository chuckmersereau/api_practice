<div ng-show="!vm.preferences.loading">
  <div id="contentbody" class="withleft">
    <div class="wpp">
      <div class="row">
        <div class="col-md-12">
          <div class="page-filters">
            <h2><%= _('Preferences') %></h2>
          </div>
        </div>
      </div>
      <form>
        <div class="row spacer-top">
          <div class="col-md-12">
            <div id="preference_alerts">
              <div id="preferences_success" class="hidden alert alert-success" role="alert">
                <strong>All done!</strong> Preferences saved successfully.
              </div>
              <div id="preferences_error" class="hidden alert alert-danger" role="alert">
                <strong>Sorry, couldn't save your changes!</strong> The following errors occurred:
                <ul></ul>
              </div>
            </div>
            <h3><%= _('About you') %></h3>
          </div>
        </div>
        <div class="panel-group" id="preferences-group">
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#preferences-group" href="#prefdata_first_name" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('First Name') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.first_name}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_first_name" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%= label :first_name, _('Your first name') %>
                      <%= text_field_tag :first_name, '', class: 'form-control', 'ng-model' => 'vm.preferences.data.first_name' %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#preferences-group" href="#prefdata_last_name" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Last Name') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.last_name}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_last_name" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%= label :last_name, _('Your last name') %>
                      <%= text_field_tag :last_name, '', class: 'form-control', 'ng-model' => 'vm.preferences.data.last_name' %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#preferences-group" href="#prefdata_email" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Email Address') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.email}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_email" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%= label :email, _('Email Address') %>
                      <%= text_field_tag :email, '', class: 'form-control', 'ng-model' => 'vm.preferences.data.email' %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#preferences-group" href="#prefdata_timezone" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Time zone') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.time_zone}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_timezone" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-7 col-md-offset-4">
                    <div class="form-group">
                      <%= label :time_zone, _('Time zone') %>
                      <%= time_zone_select( "user", "time_zone", nil, { include_blank: true }, { class: 'form-control', 'ng-model' => 'vm.preferences.data.time_zone' }) %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#preferences-group" href="#prefdata_locale" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Locale') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.locale}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_locale" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%= label :locale, _('Language') %>
                      <%= select '', :locale, locale_select_options, {}, { class: 'form-control', 'ng-model' => 'vm.preferences.data.locale' } %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#preferences-group" href="#prefdata_defacc" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Default Account') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.default_account_list}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_defacc" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%= label :default_account_list, _('Default Account List') %>
                      <%= select '', :default_account_list, current_user.account_lists.collect { |al| [al.name, al.id] }, {}, { class: 'form-control', 'ng-model' => 'vm.preferences.data.default_account_list' } %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <h3>Account Settings</h3>
          </div>
        </div>
        <div class="panel-group" id="settings-group">
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#settings-group" href="#prefdata_accountname" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Account Name') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.account_list_name}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_accountname" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%= label :account_list_name, _('Account Name') %>
                      <%= text_field_tag :account_list_name, '', class: 'form-control', 'ng-model' => 'vm.preferences.data.account_list_name' %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#settings-group" href="#prefdata_homecountry" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Home Country') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.home_country}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_homecountry" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%=  label :home_country, _('Home Country') %>
                      <%= country_select :preferences, :home_country, ['None'], {}, { class: 'country_select form-control', 'ng-model' => 'vm.preferences.data.home_country' } %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#settings-group" href="#prefdata_monthlygoal" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Monthly Goal') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.monthly_goal}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_monthlygoal" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%= label :monthly_goal, _('Monthly goal') %>
                      <%= text_field_tag :monthly_goal, '', class: 'form-control', 'ng-model' => 'vm.preferences.data.monthly_goal' %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <% if $rollout.active?(:currencies, current_account_list) %>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#settings-group" href="#prefdata_currency" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                  <i class="fa fa-angle-down panel-indicator"></i>
                  <%= _('Default Currency') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.currency}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_currency" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <div class="form-group">
                      <%= label :currency, _('Default Currency') %>
                      <%= select :currency, '', currency_select, {}, { class: 'form-control', 'ng-model' => 'vm.preferences.data.currency' } %>
                    </div>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <% end %>
          <% if $rollout.active?(:multi_currency_balance, current_account_list) %>
            <% if current_account_list.designation_organizations.count > 1 %>
              <div class="panel panel-default pref-panel">
                <div class="panel-heading pref-head">
                  <a data-toggle="collapse" data-parent="#preferences-group" href="#prefdata_currency" class="trigger collapsed" aria-expanded="false">
                    <div class="row">
                      <div class="col-sm-4">
                      <i class="fa fa-angle-down panel-indicator"></i>
                      <%= _('Primary Organization') %>
                      </div>
                      <div class="col-sm-7 pref-current">
                        {{vm.preferences.data.salary_organization_id}}
                      </div>
                      <div class="col-sm-1 text-right">
                        <span class="panel-open-btn"><%= _('Edit') %></span>
                      </div>
                    </div>
                  </a>
                </div>
                <div id="prefdata_primaryorg" class="panel-collapse collapse">
                  <div class="panel-body pref-body">
                    <div class="row pref-row">
                      <div class="col-md-8 col-md-offset-4">
                        <div class="form-group">
                          <%= label :salary_organization_id, _('Primary Organization') %>
                          <%= select :salary_organization_id, '', salary_organization_select(current_account_list), {}, { class: 'form-control', 'ng-model' => 'vm.preferences.data.salary_organization_id' } %>
                        </div>
                        <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
          <div class="panel panel-default pref-panel">
            <div class="panel-heading pref-head">
              <a data-toggle="collapse" data-parent="#preferences-group" href="#prefdata_currency" class="trigger collapsed" aria-expanded="false">
                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-angle-down panel-indicator"></i>
                    <%= _('Early Adopter') %>
                  </div>
                  <div class="col-sm-7 pref-current">
                    {{vm.preferences.data.tester}}
                  </div>
                  <div class="col-sm-1 text-right">
                    <span class="panel-open-btn"><%= _('Edit') %></span>
                  </div>
                </div>
              </a>
            </div>
            <div id="prefdata_currency" class="panel-collapse collapse">
              <div class="panel-body pref-body">
                <div class="row pref-row">
                  <div class="col-md-8 col-md-offset-4">
                    <label><%= check_box :tester, '', 'ng-model' => 'vm.preferences.data.tester' %> <%= _('Early adopter') %></label>
                    <p>
                      By checking this box, you are telling us that you'd like to test new features for bugs before they are
                      rolled out to the full MPDx user base. We'll send you an email when new features are available on your
                      account to test, and then ask for you to give us feedback - both if you experience bugs and also about
                      your thoughts about the feature(s) you are testing.
                    </p>
                    <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="page-filters page-filters-close">
              <div class="pull-right">
                <button class="btn btn-link" id="preference_reset_welcome"><%= _('Reset Welcome Tour') %></button>
              </div>
              <button type="submit" ng-click="vm.save()" class="btn btn-primary"><%= _('Save Preferences') %>&nbsp;<i class="hidden fa fa-circle-o-notch fa-spin fa-fw"></i></button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
