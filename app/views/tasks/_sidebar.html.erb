<aside id="leftmenu" class="filters_menu" data-spy="affix" data-offset-top="182" data-offset-bottom="180">
  <span class="toggle-mobile-filters close-filters hidden-lg hidden-md"><i class="fa fa-times"></i> Close Filters</span>
  <ul>
    <a href="#" ng-click="$ctrl.resetFilters()" class="btn btn-default btn-xs btn-block ng-cloak"
       ng-hide="$ctrl.isEmptyFilter()">
      <%= _('Reset Filters') %>
    </a>

    <li><span class="sort_title menu_item"><%= _('Sort') %></span></li>
    <ul class="sort_options">
      <li ng-class="{'selected': $ctrl.filter.page === 'all'}" class="option">
        <a href="/tasks/#" class="inbox " ng-click="$ctrl.filter.page = 'all'" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Sort', 'All']);"><%= _('All') %></a>
      </li>
      <li ng-class="{'selected': $ctrl.filter.page === 'today'}" class="option">
        <a href="#" class="inbox" ng-click="$ctrl.filter.page = 'today'" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Sort', 'Today']);"><%= _('Today') %></a>
      </li>
      <li ng-class="{'selected': $ctrl.filter.page === 'overdue'}" class="option">
        <a href="#" class="inbox" ng-click="$ctrl.filter.page = 'overdue'" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Sort', 'Overdue']);"><%= _('Overdue') %></a>
      </li>
      <li ng-class="{'selected': $ctrl.filter.page === 'upcoming'}" class="option">
        <a href="#" class="inbox" ng-click="$ctrl.filter.page = 'upcoming'" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Sort', 'Upcoming']);"><%= _('Upcoming') %></a>
      </li>
      <li ng-class="{'selected': $ctrl.filter.page === 'noDate'}" class="option <%= 'hidden' unless $rollout.active?(:no_date_task, current_account_list) %>">
        <a href="#" class="inbox" ng-click="$ctrl.filter.page = 'noDate'" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Sort', 'noDate']);"><%= _('No Due Date') %></a>
      </li>
      <li ng-class="{'selected': $ctrl.filter.page === 'starred'}" class="option">
        <a href="#" class="starred" ng-click="$ctrl.filter.page = 'starred'" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Sort', 'Starred']);"><%= _('Starred') %></a>
      </li>
      <li ng-class="{'selected': $ctrl.filter.page === 'history'}" class="option">
        <a href="#" class="completed" ng-click="$ctrl.filter.page = 'history'" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Sort', 'History']);"><%= _('History') %></a>
      </li>
    </ul>
    <%= render 'sidebar_tags', tags: current_account_list.activity_tags if current_account_list.activity_tags.present? %>
    <li>
      <span class="filters_title menu_item"><%= _('Filters') %></span>
      <% if params[:action] == 'history' %>
        <form method="get" action="/tasks/history">
      <% end %>
      <% if params[:action] == 'index' %>
        <form>
      <% end %>
        <ul class="filters">
          <% if params[:action] == 'history' %>
            <li class="opened">
              <label class="opened"><%= _('Date Range') %></label>
              <div class="collapse">
                <%= radio_button_tag 'filters[date_range]', 'last_week', filters_params[:date_range].blank? || filters_params[:date_range] == 'last_week' %> <%= _('Last Week') %><br />
                <%= radio_button_tag 'filters[date_range]', 'last_month', filters_params[:date_range] == 'last_month'  %> <%= _('Last 31 Days') %><br />
                <%= radio_button_tag 'filters[date_range]', 'last_year', filters_params[:date_range] == 'last_year'  %> <%= _('Last 12 Months') %><br />
                <%= radio_button_tag 'filters[date_range]', 'last_two_years', filters_params[:date_range] == 'last_two_years'  %> <%= _('Last Two Years') %><br />
                <%= radio_button_tag 'filters[date_range]', 'all', filters_params[:date_range] == 'all'  %> <%= _('All') %><br />
              </div>
            </li>
          <% end %>
          <% if params[:action] == 'index' %>
          <li>
            <label class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Action']);"><%= _('Action') %></label>
            <div class="filter_set_inner">
              <%= select_tag 'filters[activity_type]', options_for_select([[_('-- Any --'), '']] + (Task.new.assignable_activity_types & current_account_list.tasks.select(:activity_type).uniq.collect(&:activity_type)).collect { |a| [_(a), a] }, filters_params[:activity_type]), multiple: true, size: 5, class: 'form-control', :'ng-model' => '$ctrl.filter.actionSelect' %>
            </div>
          </li>
          <li>
            <label id="contact" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Contact']);"><%= _('Contact') %></label>
            <div class="filter_set_inner">
              <input ng-model="filter.contactName" type="text" placeholder="<%= _('Search or select below') %>">
              <%= select_tag 'filters[contact_ids]', options_for_select([[_('-- Any --'), '']] + current_account_list.all_contacts.collect { |c| [c.name, c.id] }, filters_params[:contact_ids]), multiple: true, size: 5, class: 'form-control', :'ng-model' => '$ctrl.filter.contactsSelect' %>
            </div>
          </li>
          <li>
            <label id="filter_status" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Contact Status']);"><%= _('Contact Status') %></label>
            <div class="filter_set_inner">
              <%= select_tag 'filters[status]',
                    options_for_select([[_('-- Any --'), ''], [_('-- None --'), 'null']] + Contact.new.assignable_statuses.collect { |s| [_(s), s] }),
                    multiple: true, size: 5, class: 'form-control', :'ng-model' => '$ctrl.filter.contactStatus' %>
            </div>
          </li>
          <li>
            <label id="filter_type" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Contact Type']);"><%= _('Contact Type') %></label>
            <div class="filter_set_inner">
              <%= select_tag 'filters[type]', options_for_select([[_('-- Any --'), ''], [_('Person'), 'person'], [_('Company'), 'company']]), multiple: false, size: 5, class: 'form-control', :'ng-model' => '$ctrl.filter.contactType' %>
            </div>
          </li>
          <li>
            <label id="filter_location" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Contact Location']);">
              <%= _('Contact Location') %>
            </label>
            <div class="filter_set_inner">
              <% location_filters = [
                [_('City'), 'city', :cities],
                [_('State'), 'state', :states],
                [_('Country'), 'country', :countries],
              ] %>
              <% location_filters.each do |location| %>
                <% options = [[_('-- Any --'), '']] + current_account_list.try(location[2]).select(&:present?) %>
                <% next if options.count <= 1 %>
                <label><%= _(location[0]) %>:</label>
                <%= select_tag 'filters['+location[1]+']', options_for_select(options),
                               multiple: true, size: [5, options.count].min, class: 'form-control',
                               :'ng-model' => '$ctrl.filter.contact'+location[0] %>
              <% end %>
            </div>
          </li>
          <li>
            <label id="filter_newsletter" class="filter_title"
                   onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Contact Newsletter']);">
              <%= _('Contact Newsletter') %>
            </label>
            <div class="filter_set_inner filter_radio">
              <label><%= radio_button_tag '', '', false, :'ng-model' => '$ctrl.filter.contactNewsletter' %> <%= _('-- Any --') %></label>
              <label><%= radio_button_tag '', 'none', false, :'ng-model' => '$ctrl.filter.contactNewsletter' %> <%= _('None Selected') %></label>
              <label><%= radio_button_tag '', 'all', false, :'ng-model' => '$ctrl.filter.contactNewsletter' %> <%= _('All') %></label>
              <label><%= radio_button_tag '', 'address', false, :'ng-model' => '$ctrl.filter.contactNewsletter' %>
                <%= _('Physical') %>
              </label>
              <label><%= radio_button_tag '', 'email', false, :'ng-model' => '$ctrl.filter.contactNewsletter' %>
                <%= _('Email') %>
              </label>
            </div>
          </li>
          <li>
            <label id="filter_pledge_frequencies" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Commitment Frequency']);"><%= _('Contact Commitment Frequency') %></label>
            <div class="filter_set_inner">
              <%= select_tag 'filters[pledge_frequencies]',
                             options_for_select([[_('-- Any --'), '']] + current_account_list.contacts.pledge_frequencies.invert.to_a, current_account_list.contacts.pledge_frequencies.to_a),
                             class: 'form-control', multiple: true, size: current_account_list.contacts.pledge_frequencies.to_a.size, :'ng-model' => '$ctrl.filter.contactPledgeFrequencies' %>
            </div>
          </li>
          <li>
            <label id="filter_referrer" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Referrer']);"><%= _('Contact Referrer') %></label>
            <div class="filter_set_inner">
              <%= select_tag 'filters[referrer]', options_for_select([[_('-- Any --'), ''], [_('-- Someone --'), '*']] + current_account_list.contacts.with_referrals.order("name").collect { |c| [c.name, c.id] }), multiple: true, size: 5, class: 'form-control', :'ng-model' => '$ctrl.filter.contactReferrer' %>
            </div>
          </li>

          <li>
            <label id="filter_likely" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Likely To Give']);"><%= _('Contact Likely To Give') %></label>
            <div class="filter_set_inner">
              <%= select_tag '', options_for_select([[_('-- Any --'), ''], [_('Least Likely'),'Least Likely'],
                                                     [_('Likely'),'Likely'], [_('Most Likely'),'Most Likely']]),
                             multiple: true, size: 4, class: 'form-control', :'ng-model' => '$ctrl.filter.contactLikely' %>
            </div>
          </li>

          <li>
            <label id="filter_church" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Contact Church']);"><%= _('Contact Church') %></label>
            <div class="filter_set_inner">
              <%= select_tag 'filters[church]', options_for_select([[_('-- Any --'), '']] + current_account_list.churches.select(&:present?)), multiple: true, size: 5, class: 'form-control', :'ng-model' => '$ctrl.filter.contactChurch' %>
            </div>
          </li>

          <li>
            <label id="filter_timezone" class="filter_title" onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Timezone']);"><%= _('Contact Timezone') %></label>
            <div class="filter_set_inner">
              <%= select_tag 'filters[timezone]', options_for_select([[_('-- Any --'), '']] + current_account_list.timezones.select(&:present?)), multiple: true, size: 5, class: 'form-control', :'ng-model' => '$ctrl.filter.contactTimezone' %>
            </div>
          </li>
          <li class="filter_set">
            <label id="filter_contact_info" class="filter_title"
                           onClick="_gaq.push(['_trackEvent', 'Tasks Page', 'Filters', 'Contact Information']);">
            <%= _('Contact Information') %></label>
            <div class="filter_set_inner filter_radio">
              <%= _('Email') %>
              <label ><%= radio_button_tag '', '', false, :'ng-model' => '$ctrl.filter.contactInfoEmail' %><%= _('-- Any --') %><br/>
                <%= radio_button_tag '', 'Yes', false, 'ng-model' => '$ctrl.filter.contactInfoEmail'  %><%= _('Yes') %><br/>
                <%= radio_button_tag '', 'No', false, 'ng-model' => '$ctrl.filter.contactInfoEmail' %><%= _('No') %></label>
              <%= _('Home Phone') %>
              <label ><%= radio_button_tag '', '', false, :'ng-model' => '$ctrl.filter.contactInfoPhone' %><%= _('-- Any --') %><br/>
                <%= radio_button_tag '', 'Yes', false, 'ng-model' => '$ctrl.filter.contactInfoPhone'%><%= _('Yes') %><br/>
                <%= radio_button_tag '', 'No', false, 'ng-model' => '$ctrl.filter.contactInfoPhone' %><%= _('No') %></label>
              <%= _('Mobile Phone') %>
              <label ><%= radio_button_tag '', '', false, :'ng-model' => '$ctrl.filter.contactInfoMobile' %><%= _('-- Any --') %><br/>
                <%= radio_button_tag '', 'Yes', false, 'ng-model' => '$ctrl.filter.contactInfoMobile'  %><%= _('Yes') %><br/>
                <%= radio_button_tag '', 'No', false, 'ng-model' => '$ctrl.filter.contactInfoMobile' %><%= _('No') %>
              </label>
              <%= _('Address') %>
              <label ><%= radio_button_tag '', '', false, :'ng-model' => '$ctrl.filter.contactInfoAddr' %><%= _('-- Any --') %><br/>
                <%= radio_button_tag '', 'Yes', false, 'ng-model' => '$ctrl.filter.contactInfoAddr'  %><%= _('Yes') %><br/>
                <%= radio_button_tag '', 'No', false, 'ng-model' => '$ctrl.filter.contactInfoAddr' %><%= _('No') %>
              </label>
              <%= _('Facebook Profile') %>
              <label><%= radio_button_tag '', '', false, :'ng-model' => '$ctrl.filter.contactInfoFacebook' %><%= _('-- Any --') %><br/>
                <%= radio_button_tag '', 'Yes', false, 'ng-model' => '$ctrl.filter.contactInfoFacebook'  %><%= _('Yes') %><br/>
                <%= radio_button_tag '', 'No', false, 'ng-model' => '$ctrl.filter.contactInfoFacebook' %><%= _('No') %>
              </label>
            </div>
          </li>
          <% end %>
        </ul>
      </form>
    </li>
    <a href="#" ng-click="$ctrl.resetFilters()" class="btn btn-default btn-xs btn-block ng-cloak"
       ng-hide="$ctrl.isEmptyFilter()">
      <%= _('Reset Filters') %>
    </a>
  </ul>
</aside>
