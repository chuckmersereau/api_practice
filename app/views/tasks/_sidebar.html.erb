<aside id="leftmenu">
<ul>
  <li class="<%= 'selected' if params[:action] == 'index' %>"><%= link_to(_('Active/Upcoming'), tasks_path, class: "inbox menu_item") %></li>
  <li class="<%= 'selected' if params[:action] == 'starred' %>"><%= link_to(_('Starred'), starred_tasks_path, class: "starred menu_item") %></li>
  <li class="<%= 'selected' if params[:action] == 'history' %>"><%= link_to(_('History'), history_tasks_path, class: "completed menu_item") %></li>
  <% if current_account_list.activity_tags.present? %>
    <li class="<%= 'selected' if params[:tags] %>">
      <span class="tags menu_item"><%= _('Tags') %></span>
      <ul class="left_taglist tags">
        <li>
          <% current_account_list.activity_tags.each do |tag|
            # toggle tag on / off
            tag_params = params.except(:action, :controller)
            if params[:tags] && params[:tags].include?(tag)
              tag_params[:tags] = (params[:tags] - [tag])
            else
              tag_params[:tags] = (Array.wrap(params[:tags]) + [tag])
            end
            tag_params.delete(:tags) if tag_params[:tags].blank? %>

            <%= link_to(tag, tag_params, class: "tag #{'selected' if params[:tags] && params[:tags].include?(tag)}")%>
          <% end %>
        </li>
      </ul>
    </li>
  <% end %>
  <li>
    <span class="left_filters menu_item"><%= _('Filters') %></span>
    <%= form_tag params.slice(:controller, :action), method: :get do %>
      <ul class="left_filters">
        <% if params[:action] == 'history' %>
          <li>
            <label><%= _('Date Range') %></label>
            <div class="collapse">
              <%= radio_button_tag :date_range, 'last_week', params[:date_range].blank? || params[:date_range] == 'last_week' %> <%= _('Last Week') %><br />
              <%= radio_button_tag :date_range, 'last_month', params[:date_range] == 'last_month'  %> <%= _('Last 31 Days') %><br />
              <%= radio_button_tag :date_range, 'last_year', params[:date_range] == 'last_year'  %> <%= _('Last 12 Months') %><br />
              <%= radio_button_tag :date_range, 'last_two_years', params[:date_range] == 'last_two_years'  %> <%= _('Last Two Years') %><br />
              <%= radio_button_tag :date_range, 'all', params[:date_range] == 'all'  %> <%= _('All') %><br />
            </div>
          </li>
        <% end %>
        <li>
          <label><%= _('Tags') %></label>
          <div class="collapse">
            <%= select_tag :tags, options_for_select([[_('-- Any --'), '']] + current_account_list.activity_tags, params[:tags]), multiple: true, size: 5 %>
          </div>
        </li>
        <li>
        <label><%= _('Action') %></label>
          <div class="collapse">
            <%= select_tag :activity_type, options_for_select([[_('-- Any --'), '']] + (Task.new.assignable_activity_types & current_account_list.tasks.select(:activity_type).uniq.collect(&:activity_type)).collect { |a| [_(a), a] }, params[:activity_type]), multiple: true, size: 5 %>
          </div>
        </li>
        <li>
          <label><%= _('Contact') %></label>
          <div class="collapse">
            <%= select_tag :contact_ids, options_for_select([[_('-- Any --'), '']] + all_contacts.collect { |c| [c.name, c.id] }, params[:contact_ids]), multiple: true, size: 5 %>
          </div>
        </li>
        <li class="controls">
          <%= submit_tag _('Apply Filters') %>
          <%= link_to(_('Reset Filters'), tasks_path, style: 'font-size: 11px') %>
        </li>
      </ul>
    <% end %>
  </li>
</ul>
</aside>

