<% if task && task.errors.any? %>
  <div id="error_explanation">
    <ul>
      <% task.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<div class="field">
  <%= f.label :subject, _('Subject') %>
  <%= f.text_field :subject, autofocus: true, maxlength: 255, required: true %>
</div>

<div class="field">
  <%= f.label :activity_type, _('Action') %>
  <%= f.select :activity_type, f.object.assignable_activity_types.collect { |s| [_(s), s] }, include_blank: true %>
</div>

<% if task.completed? %>
  <%= f.hidden_field :completed %>
  <div class="field">
    <%= f.label :start_at, _('Completed On') %>
    <%= calendar_date_select_tag 'completed-on' %>
    <%= f.time_select :completed_at, ampm: true, default: 0.day.from_now, order: [:month, :day, :year] %>
  </div>

  <div class="field">
    <%= f.label :result, _('Result') %>
    <%= f.select :result, task.result_options %>
  </div>

  <div class="field">
    <%= f.label :next_action, _('Next Action') %>
    <%= f.select :next_action, task.next_action_options %>
  </div>
<% else %>
  <div class="field due_date" style="display: <%= 'none' if task[:no_date] %>;">
    <%= f.label :start_at, _('Due Date') %>
    <%= calendar_date_select_tag 'due-date', (I18n.l(f.object.start_at.to_date) if f.object.start_at) %>
    <%= f.time_select :start_at, ampm: true, default: 1.day.from_now, order: [:month, :day, :year] %>
  </div>
  <div class="field">
    <%= f.check_box :no_date, { id: 'no_date' }, true, false %> No due date
  </div>
<% end %>

<div class="field">
  <%= f.label :tag_list, _('Tags') %>
  <%= f.text_field :tag_list %>
</div>

<div class="field task_location" <% if task.activity_type != 'Appointment' %>style="display: none;"<% end %>>
  <%= f.label :location, _('Location') %>
  <%= f.text_field :location, { placeholder: task.calculated_location } %>
  <small><%= _("Defaults to contact's primary address") %></small>
</div>

<div class="field">

  <% comment = task.activity_comments.build %>
  <%= f.fields_for :activity_comments, [comment] do |builder| %>
    <%= builder.label :body, _('Add Comment') %>
    <%= builder.text_area :body, rows: 3 %>
  <% end %>
</div>
