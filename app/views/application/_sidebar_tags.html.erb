<li ng-class="{'selected': contactQuery.tags[0]}" ng-show="!insightFilterIsActive()">
  <span class="tags_title menu_item"><%= _('Tags') %></span>
  <ul class="left_tag_list tags">
    <li>
      <% tags.each do |tag|
        # toggle tag on / off
        url_params = {}.merge(params.except(:action, :controller, :page))
        url_params['filters'] = {}.merge(filters_params)
        tag_params.to_s.split(',').tap do |tags|
          if tags.include?(tag)
            url_params['filters']['tags'] = (tags - [tag]).join(',')
          else
            url_params['filters']['tags'] = (tags + [tag]).join(',')
          end %>
          <span class="tag" ng-class="{'selected': tagIsActive('<%= j(tag) %>')}" ng-click="tagClick('<%= j(tag) %>', $event)"><%= tag %>
                <% if params[:controller] == 'contacts' %>
                    <%= link_to '', "/tags/1?remove_tag_name=#{tag}&all_contacts=1", class: "tag_remove", namespace: 'remove_tag', method: :delete,
                                data: { confirm: 'Are you sure you want to remove this tag from all contacts?'}, :remote => true %>
                <% else params[:controller] == 'tasks' %>
                    <%= link_to '', "/tags/1?remove_tag_name=#{tag}&all_tasks=1", class: "tag_remove", namespace: 'remove_tag', method: :delete,
                                data: { confirm: 'Are you sure you want to remove this tag from all tasks?'}, :remote => true %>
                <% end %>
          </span>
        <% end %>
      <% end %>
      <a href="#" class="show_all_tags_btn" onClick="_gaq.push(['_trackEvent', 'Contacts Events', 'Click', 'See all tags']);"><i class="fa fa-plus"></i> See all <span class="tagSize"></span> tags</a>
    </li>
  </ul>
</li>

<script>
var tagSize = $('.left_tag_list .tag').length;
$('.tagSize').html(tagSize);
if (tagSize < 15) {
  $('.show_all_tags_btn').hide();
}
$('.show_all_tags_btn').click(function() {
  $('.left_tag_list').toggleClass('show_all_tags');
})
</script>
