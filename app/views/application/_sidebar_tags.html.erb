<li class="<%= 'selected' if tag_params.present? %>">
  <span class="tags menu_item"><%= _('Tags') %></span>
  <ul class="left_taglist tags">
    <li>
      <% tags.each do |tag|
        # toggle tag on / off
        url_params = {}.merge(params.except(:action, :controller, :page))
        url_params['filters'] = {}.merge(filters_params)
        tag_params.to_s.split(',').tap do |tags|
          if tags.include?(tag)
            url_params['filters']['tags'] = (tags - [tag]).join(',')
          else
            url_params['filters']['tags'] = (tags + [tag]).join(',')
          end %>

          <%= link_to(tag, url_params, class: "tag #{'selected' if tags.include?(tag)}") %>
        <% end %>
      <% end %>
    </li>
  </ul>
</li>
